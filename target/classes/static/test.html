<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<script src="/js_keys.js"></script>
<script>
  // (g => { var h, a, k, p = "The Google Maps JavaScript API", c = "google", l = "importLibrary", q = "__ib__", m = document, b = window; b = b[c] || (b[c] = {}); var d = b.maps || (b.maps = {}), r = new Set, e = new URLSearchParams, u = () => h || (h = new Promise(async (f, n) => { await (a = m.createElement("script")); e.set("libraries", [...r] + ""); for (k in g) e.set(k.replace(/[A-Z]/g, t => "_" + t[0].toLowerCase()), g[k]); e.set("callback", c + ".maps." + q); a.src = `https://maps.${c}apis.com/maps/api/js?` + e; d[q] = f; a.onerror = () => h = n(Error(p + " could not load.")); a.nonce = m.querySelector("script[nonce]")?.nonce || ""; m.head.append(a) })); d[l] ? console.warn(p + " only loads once. Ignoring:", g) : d[l] = (f, ...n) => r.add(f) && u().then(() => d[l](f, ...n)) })({
  //   key: GOOGLE_MAP_KEY,
  //   // Add other bootstrap parameters as needed, using camel case.
  //   // Use the 'v' parameter to indicate the version to load (alpha, beta, weekly, etc.)
  // });

  //현재위치 마커 표시
  // function getCurrentPositionPromise() {
  //   return new Promise((resolve, reject) => {
  //     navigator.geolocation.getCurrentPosition(resolve, reject);
  //   });
  // }

  // async function fetchAndProcessPosition() {
  //   try {
  //     const geolocationPosition = await getCurrentPositionPromise();
  //     const position = { lat: geolocationPosition.coords.latitude, lng: geolocationPosition.coords.longitude };
  //     console.log(position);

  //     const { Map } = await google.maps.importLibrary("maps");

  //     // The map, centered at Uluru
  //     map = new Map(document.getElementById("map"), {
  //       zoom: 4,
  //       center: position,
  //       mapId: "DEMO_MAP_ID",
  //     });

  //     // The marker, positioned at Uluru
  //     new google.maps.Marker({
  //       position: position,
  //       map,
  //       title: "Hello World!",
  //     });

  //   } catch (error) {
  //     console.error(error); // 에러 처리
  //   }
  // }

  // fetchAndProcessPosition();


  //현재 위치 추적해서 로고찍기
  const watchId = navigator.geolocation.watchPosition(
    (position) => {
      const { latitude, longitude } = position.coords;
      console.log(`Latitude: ${latitude}, Longitude: ${longitude}`);
    },
    (error) => {
      //console.error(`Error: ${error.message}`);
      console.log(error);
    },
    {
      enableHighAccuracy: true, // 더 정확한 위치를 요청
      maximumAge: 0, // 캐시된 위치 정보를 사용하지 않음
      timeout: Infinity // 타임아웃 없음
    }
  );


  //선그리기 기본
  function initMap() {
    const map = new google.maps.Map(document.getElementById("map"), {
      zoom: 3,
      center: { lat: 0, lng: -180 },
      mapTypeId: "terrain",
    });
    const flightPlanCoordinates = [
      { lat: 37.772, lng: -122.214 },
      { lat: 21.291, lng: -157.821 },
      { lat: -18.142, lng: 178.431 },
      { lat: -27.467, lng: 153.027 },
    ];
    const flightPath = new google.maps.Polyline({
      path: flightPlanCoordinates,
      geodesic: true,
      strokeColor: "#FF0000",
      strokeOpacity: 1.0,
      strokeWeight: 2,
    });

    flightPath.setMap(map);
  }

  window.initMap = initMap;











  // const watchID = navigator.geolocation.watchPosition((position) => {
  // doSomething(position.coords.latitude, position.coords.longitude);
  // https://developer.mozilla.org/ko/docs/Web/API/Geolocation_API/Using_the_Geolocation_API
  // });

  // async function initMap() {
  //   // The location of Uluru
  //   const position = { lat: position_check.latitude, lng: position_check.longitude};
  //   // Request needed libraries.
  //   //@ts-ignore
  //   const { Map } = await google.maps.importLibrary("maps");
  //   const { AdvancedMarkerView } = await google.maps.importLibrary("marker");

  //   // The map, centered at Uluru
  //   map = new Map(document.getElementById("map"), {
  //     zoom: 4,
  //     center: position,
  //     mapId: "DEMO_MAP_ID",
  //   });

  //   // The marker, positioned at Uluru
  //   const marker = new AdvancedMarkerView({
  //     map: map,
  //     position: position,
  //     title: "Uluru",
  //   });
  // }

  // initMap();
</script>
<style>
  /* 
 * Always set the map height explicitly to define the size of the div element
 * that contains the map. 
 */
  #map {
    height: 100%;
  }

  /* 
 * Optional: Makes the sample page fill the window. 
 */
  html,
  body {
    height: 100%;
    margin: 0;
    padding: 0;
  }
</style>
<script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>

<body>
  <h3>My Google Maps Demo</h3>
  <!--The div element for the map -->
  <div id="map"></div>

  <script id="script" type="text/javascript" charset="utf-8" defer></script>
  <script>
     document.getElementById("script").src = 'https://maps.googleapis.com/maps/api/js?key='+GOOGLE_MAP_KEY+'&callback=initMap&v=weekly';

     
  </script>
  
></script>
</body>

</html>