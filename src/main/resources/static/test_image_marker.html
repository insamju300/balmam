<!DOCTYPE html>
<html>
<head>
    <title>Image Upload Marker on Google Maps</title>
    <style>
        #map {
            height: 400px;
            width: 100%;
        }
        /* 모달 스타일 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgb(0,0,0);
            background-color: rgba(0,0,0,0.4);
            padding-top: 60px;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
        }
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        .image-preview {
            width: 100%;
        }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?key=MYKEY"></script>
</head>
<body>
    <input type="file" id="imageUpload" accept="image/*">
    <div id="map"></div>
    <!-- 모달 추가 -->
    <div id="myModal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <img src="" class="image-preview">
        </div>
    </div>
    <script>
        let map;
        let userLocationMarker;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 18,
                center: {lat: -34.397, lng: 150.644},
                mapTypeId: 'roadmap'
            });

            navigator.geolocation.getCurrentPosition(function(position) {
                const userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };
                map.setCenter(userLocation);
                
                document.getElementById('imageUpload').addEventListener('change', function(event) {
        const file = event.target.files[0];
        const reader = new FileReader();
        
        reader.onloadend = function() {
            localStorage.setItem('uploadedImage', reader.result);

            if (userLocationMarker) {
                userLocationMarker.setMap(null);
            }
            userLocationMarker = new google.maps.Marker({
                position: userLocation,
                map: map,
                // 빨간색 원 테두리 추가
                icon: {
                    url: reader.result,
                    scaledSize: new google.maps.Size(50, 50),
                    strokeColor: 'red',
                    strokeWeight: 2,
                    fillColor: '#FF0000',
                    fillOpacity: 1,
                }
            });

            // 마커 클릭 시 모달 표시
            userLocationMarker.addListener('click', function() {
                const modal = document.getElementById('myModal');
                const span = document.getElementsByClassName('close')[0];
                const imagePreview = document.querySelector('.image-preview');

                imagePreview.src = reader.result;
                modal.style.display = "block";

                span.onclick = function() {
                    modal.style.display = "none";
                }

                window.onclick = function(event) {
                    if (event.target == modal) {
                        modal.style.display = "none";
                    }
                }
            });
        };

        if (file) {
            reader.readAsDataURL(file);
        }
    });
               
            }, function() {
                handleLocationError(true, map.getCenter());
            });
        }

        function handleLocationError(browserHasGeolocation, pos) {
            console.log(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
        }

        initMap();
    </script>
</body>
</html>