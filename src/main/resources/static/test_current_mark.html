<!DOCTYPE html>
<html>
<head>
    <title>Real-Time Location on Google Maps</title>
    <style>
        /* 지도를 표시할 div의 크기 설정 */
        #map {
            height: 400px;
            width: 100%;
        }
    </style>

    <script src="https://maps.googleapis.com/maps/api/js?key=MyJsKey"></script>

</head>
<body>
    <div id="map"></div>
    <script>
        let map;
        let userLocationMarker;

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 18, // 초기 확대 레벨 설정
                center: {lat: -34.397, lng: 150.644}, // 초기 중앙 위치 설정 (임시값)
                mapTypeId: 'roadmap' // 지도 유형 설정
            });

            // 사용자의 현재 위치를 추적하는 navigator.geolocation.watchPosition 사용
            navigator.geolocation.watchPosition(function(position) {//https://developer.mozilla.org/ko/docs/Web/API/Geolocation/watchPosition
                const userLocation = {
                    lat: position.coords.latitude,
                    lng: position.coords.longitude
                };

                // 사용자의 현재 위치에 마커 생성 또는 업데이트
                if (userLocationMarker) {
                    // 마커가 이미 존재하면 위치만 업데이트
                    userLocationMarker.setPosition(userLocation);
                } else {
                    // 새로운 마커 생성
                    userLocationMarker = new google.maps.Marker({
                        position: userLocation,
                        map: map,
                        title: 'Your Location',
                        icon: {
                            path: google.maps.SymbolPath.CIRCLE,
                            scale: 7, // 동그라미 크기 조절
                            fillColor: '#FF0000',
                            fillOpacity: 1,
                            strokeWeight: 2
                        }
                    });
                }

                // 지도의 중앙을 사용자의 현재 위치로 설정
                map.setCenter(userLocation);
            }, function() {
                handleLocationError(true, map.getCenter());
            });
        }

        function handleLocationError(browserHasGeolocation, pos) {
            console.log(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
        }

        initMap();
    </script>
</body>
</html>